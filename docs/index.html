<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table of Contents Bookmarklet</title>
    <link rel="stylesheet" href="docs.css">
</head>
<body>
    <main>
        <h1>Table of Contents Bookmarklet</h1>
        <p>Document outlines are helpful when you want to skim a document—whether you do that with your eyeballs, eardrums, fingertips, or brainwave injections.</p>
        <p>In 2016 Marijke Luttekes wrote a bookmarklet that prints the document outline of the current document. Super helpful for getting that quick overview. Helper for people that want to know what’s on the page. Helpful for developers that want to check their document’s outline. Helpful for everyone!</p>
        <p>One thing that “annoyed” me was that the list with results wasn’t indented. This is my attempt to build on Marijke’s work.</p>
        <button type="button" aria-haspopup="dialog" id="toc-bookmarklet-button">Try it out!</button>
        
        <p>Installation, bookmark this link: <a href="javascript:(()=>{let headings=document.querySelectorAll('h1,h2,h3,h4,h5,h6,[role=heading]');let containerId='toc-bookmarklet';let tocActivated=document.getElementById(containerId)?true:false;let hideHidden=true;if(headings.length&&tocActivated===false){let headingsList=[];let containerHeadingId=`${ containerId }-heading`;let styles=document.createElement(%27style%27);styles.setAttribute(%27type%27,%27text/css%27);styles.setAttribute(%27title%27,%27Table of Contents Bookmarklet%27);let container=document.createElement(%27div%27);container.id=containerId;container.role=%27dialog%27;container.setAttribute(%27aria-labelledby%27,containerHeadingId);container.setAttribute(%27tabindex%27,%27-1%27);let containerHeader=document.createElement(%27header%27);let containerHeading=document.createElement(%27h1%27);containerHeading.setAttribute(%27id%27,containerHeadingId);containerHeading.innerText=%27Table of Contents%27;containerHeader.appendChild(containerHeading);let closeButton=document.createElement(%27button%27);closeButton.type=%27button%27;closeButton.textContent=%27x%27;closeButton.ariaLabel=%27Close ToC%27;closeButton.addEventListener(%27click%27,()=>container.remove());let list=document.createElement(%27ol%27);list.id=`${ containerId }-list`;let globalEscapeBound=globalEscape.bind(this);document.addEventListener(%27keydown%27,globalEscapeBound);function removeGlobalListener(){document.removeEventListener(%27keydown%27,globalEscapeBound)}function globalEscape(event){if(event.key===%27Escape%27||event.key===%27Esc%27){container.remove();removeGlobalListener()}}containerHeader.appendChild(closeButton);container.appendChild(containerHeader);let intro=document.createElement(%27p%27);intro.innerText=%27H# for HTML, A# for ARIA.';container.appendChild(intro);let settings=document.createElement('div');let label=document.createElement('label');let labelText=document.createTextNode('Hide hidden headings');let checkbox=document.createElement('input');checkbox.setAttribute('type','checkbox');checkbox.role='switch';checkbox.checked=hideHidden;checkbox.addEventListener('change',settingsChange);label.appendChild(checkbox);label.appendChild(labelText);settings.appendChild(label);container.appendChild(settings);function settingsChange(){hideHidden=checkbox.checked;removeHeadingList();generateHeadingList();addHeadingList()}function removeHeadingList(){let headingListElement=document.getElementById(list.id);if(headingListElement){list.innerHTML=null;headingListElement.remove()}}function addHeadingList(){container.appendChild(list)}headings.forEach(heading=>getHeadingInfo(heading));function getHeadingInfo(heading){let role=heading.role;let text=heading.textContent.trim();let nodeName=heading.nodeName;let level,type,id;let hidden=checkHeadingVisibility(heading);if(heading[Symbol.toStringTag]==='HTMLHeadingElement'){type='HTML';level=heading.nodeName[1]}if(role==='heading'){type='ARIA';level=heading.ariaLevel}if(heading.id){id=heading.id}headingsList.push({type:type,level:level,text:text,nodeName:nodeName,id:id,hidden:hidden})};function checkHeadingVisibility(heading){let{length}=heading.getClientRects();let visibility=window.getComputedStyle(heading).visibility==='hidden';let ariaHidden=heading.closest('[aria-hidden]')!=null;let inert=heading.closest('[inert]')!=null;let hidden=length===0||visibility===true||ariaHidden===true||inert===true;return hidden};function filterHiddenHeadings(item){if(item.hidden===true){return false}return true}function generateHeadingList(){if(document.getElementById(list.id)){removeHeadingList()}if(hideHidden){let filtered=headingsList.filter(filterHiddenHeadings);filtered.forEach(heading=>createHeadingListItem(heading));return}headingsList.forEach(heading=>createHeadingListItem(heading))}generateHeadingList();function createHeadingListItem(heading){let listItem=document.createElement('li');let dashes='–'.repeat(heading.level);let headingTextNode=document.createTextNode(heading.text);let type=heading.type==='ARIA'?'A':'H';listItem.innerText=%60${ dashes } ${ type }${heading.level }: %60;if(heading.id){let link=document.createElement('a');link.href=%60#${heading.id }%60;link.innerText=heading.text;headingTextNode=link}listItem.appendChild(headingTextNode);list.appendChild(listItem)};let mac=navigator.appVersion.indexOf('Mac')!=-1?true:false;let macButton=mac?'grid-area: macButton;':'';styles.innerText=%60#${ containerId } {                display: inline-block;                position: fixed;                top: 0;                left: 0;                z-index: 9999;                margin: 0.5em;                padding: 0 .5em;                max-width: calc(100% - 1em);                max-height: calc(100% - 1em);                border: .0625em solid rgba(0,0,0,.3);                border-radius: .25em;                box-shadow: 0 .25em .5em rgba(0,0,0,.3);                overflow-y: scroll;                color: black;                font-family: sans-serif;                font-size: max(1em, 16px);                line-height: 1.5;                background-color: white;            }            #${ containerId }:focus-visible,             #${ containerId } :focus {                outline: 2px solid transparent;                box-shadow:                     0 0 0 .125em white,                    0 0 0 .25em hsl(260, 30%, 53%),                    0 .25em .5em rgba(0,0,0,.3);            }            #${ containerId } header {                display: grid;                grid-template-columns: 1.5em auto 1.5em;                grid-template-areas: 'macButton heading button';                grid-gap: .5em;                width: calc(100% + 1em);                margin: 0 -.5em;                padding: .5em;                border-bottom: .0625em solid rgba(0,0,0,.3);            }            #${ containerId } h1 {                margin: 0;                font-family: inherit;                font-size: 1em;                font-weight: bold;                line-height: inherit;                text-align: center;                grid-area: heading;            }            #${ containerId } button {                width: 1.5em;                height: 1.5em;                grid-area: button;                ${ macButton }                border: 1px solid #605a6d;                border-radius: 5px;                box-shadow: 0 1px 2px #403b44;                color: #fff;                font-family: inherit;                font-size: inherit;                text-shadow: 0 -1px 1px #403b44;                background-color: #7f6699;                background-image: linear-gradient(to bottom, #866f9f, #776090);                cursor:pointer;            }            #${ containerId } a {                color: hsl(260, 30%, 53%);            }            #${ containerId } ol {                list-style-position: inside;                list-style-type: none;                margin: 1em 0;                padding: 0;            }%60;addHeadingList();document.head.appendChild(styles);document.body.appendChild(container);container.focus()}})();">ToC</a></p>
        <section>
            <h2 id="changes">Things I changed</h2>
            <p>Marijke’s previous work served as the basis for this version. A lot of the logic is a direct copy! I did add a few things:</p>
            <ul>
                <li>In addition to HTML native headings (<code>&lt;h1&gt;</code>-<code>&lt;h6&gt;</code>) it now also checks for ARIA headings (<code>[role="heading"]</code>)</li>
                <li>Ability to hide hidden headings</li>
                <li>Styles are placed in a <code>&lt;style&gt;</code> element</li>
                <li>Removed the disc list style</li>
                <li>The dialog is now a true dialog</li>
                <li>Escape now closes the dialog</li>
                <li>Looks a bit nicer</li>
                <li>Code is now 4,5 times longer (whoops)</li>
            </ul>
            
            <h3 id="aria">Checking for ARIA headings</h3>
            <p>To make this work a few things needed to happen:</p>
            <ol>
                <li>Add ARIA headings to initial list (so they’re in order)</li>
                <li>Get their <code>aria-level</code> information</li>
                <li>Get the same information from the HTML headings</li>
                <li>Put all of that in a list for further processing</li>
            </ol>
            
            <h3 id="considerations">Other considerations</h3>
            <p>
                While I said that the lack of indenting was annoying I didn’t add it.
                It would require nested lists for each heading level.
                This is no problem in coding but I felt it would be annoying for AT users.
                This bookmarklet is best compared with things like the list feature in JAWS or the Web Rotor in VoiceOver—those are flat lists too.
                While AT users aren’t the main audience here—they already have this functionality!—it’s good to be considerate nevertheless.
            </p>
        </section>
        <section>
            <h2 id="related-links">Related links</h2>
            <ul>
                <li><a href="https://codepen.io/MHLut/pen/ZOaEVX">Original by Marijke Luttekes</a></li>
                <li><a href="https://marijkeluttekes.dev/blog/articles/2022/02/17/table-of-contents-bookmarklet-v1/">Blog by Marijke Luttekes</a></li>
                <li><a href="https://codepen.io/Moiety/pen/GROyGJP/0c74425c342f617575cc3d592d46d7b4?editors=1011">Visibility check code</a>; with thanks to Anne-Greeth and Marijn</li>
                <li><a href="https://html.spec.whatwg.org/multipage/semantics.html#the-style-element">HTML: the Style element</a>; looked up needed attributes</li>
                <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/toStringTag">MDN: Symbol.toStringTag</a>; wanted a universal way to check if an element was a HTML heading (without checking against a list of h#-tags)</li>
                <li><a href="https://github.com/WICG/aom/blob/gh-pages/explainer.md">Accessibility Object Model</a>; wanted to use AOM, but seems it’s no longer implemented :(</li>
                <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/switch">MDN: Switch</a>; I always forget the syntax, ended up solving it another way</li>
            </ul>
        </section>
        <section>
            <h2 id="special-thanks">Special thanks</h2>
            <p>My thanks go out to these people for their help in the development of this Bookmarklet.</p>
            <ul>
                <li><a href="https://twitter.com/MHLut">Marijke Luttekes</a></li>
                <li><a href="https://twitter.com/ActiveB1t">Marijn</a></li>
                <li><a href="https://twitter.com/agvanherwijnen">Anne-Greeth Schot-van Herwijnen</a></li>
                <li><a href="https://twitter.com/codeability">EJ Mason</a></li>
            </ul>
        </section>
        <section>
            <div role="heading" aria-level="2">Example Headings</div>
            <p>A bunch of headings to show things work!</p>
            <h3>Level three HTML heading</h3>
            <h3 style="display: none">display: none</h3>
            <h3 style="visibility: hidden">visibility: hidden</h3>
            <h3 id="example-h3">Level three HTML heading with an id</h3>
            <div role="heading" aria-level="4">Level four ARIA heading</div>
            <div style="visibility: hidden"><h4>visibility: hidden (parent)</h4></div>
            <div role="heading" aria-level="4">Another level four ARIA heading</div>
            <div style="display: none"><h5>display: none (parent)</h5></div>
            <div role="heading" aria-level="5">Level five ARIA heading</div>
            <div role="heading" aria-level="5" id="some-id">Level five ARIA heading with an id</div>
            <h6>Level six HTML heading</h6>
            <h6 aria-hidden="true">aria-hidden</h6>
            <div aria-hidden="true"><h3>aria-hidden (parent)</h3></div>
            <div inert><h3>inert parent</h3></div>
        </section>
    </main>
    <script src="app.js"></script>
</body>
</html>